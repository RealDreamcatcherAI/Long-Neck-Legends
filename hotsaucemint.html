<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" type="image/png" sizes="32x32" href="https://i.imgur.com/jpGdtHJ.jpeg">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LNL Hot Sauce Mint | Mango Habanero Ascension</title>

  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, Helvetica, sans-serif;
      background: #0a0a1a;
      color: #e0e0ff;
      overflow-x: hidden;
      opacity: 0;
      transition: opacity 1s ease;
    }
    body.loaded { opacity: 1; }

    nav {
      position: fixed;
      top: 0;
      width: 100%;
      padding: 1rem 0;
      background: rgba(10,10,26,0.9);
      backdrop-filter: blur(10px);
      z-index: 1000;
      text-align: center;
    }
    nav a {
      color: #e0e0ff;
      margin: 0 1.5rem;
      text-decoration: none;
      font-weight: 600;
      position: relative;
    }
    nav a::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 0;
      height: 2px;
      background: #00d4ff;
      transition: 0.3s;
    }
    nav a:hover::after { width: 100%; }

    .hotsauce-banner { padding-top: 90px; text-align: center; }
    .hotsauce-banner img {
      width: 100%;
      max-width: 800px;
      display: block;
      margin: 0 auto;
    }

    .sauce-info {
      max-width: 900px;
      margin: 0 auto;
      text-align: center;
      font-size: 1.15rem;
      padding: 1rem;
    }

    h2 {
      font-family: "Trebuchet MS", Helvetica, sans-serif;
      font-weight: bold;
      font-size: 3rem;
      text-align: center;
      margin: 2rem 0 1.5rem;
      background: linear-gradient(45deg, #00d4ff, #ff6bff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .boxstyle {
      margin: 3rem auto;
      padding: 2.5rem 2rem;
      max-width: 900px;
      background: rgba(20,20,40,0.6);
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,212,255,0.25);
      text-align: center;
    }

    .btn-glow {
      display: inline-block;
      padding: 1rem 2.5rem;
      margin: 0.5rem;
      font-family: "Trebuchet MS", Helvetica, sans-serif;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      border-radius: 50px;
      text-decoration: none;
      position: relative;
      overflow: hidden;
      z-index: 1;
      transition: all 0.25s ease;
      cursor: pointer;
      border: none;
    }
    .btn-primary {
      background: linear-gradient(45deg, #00d4ff, #0099cc);
      color: white;
      box-shadow: 0 0 20px rgba(0,212,255,0.45);
    }
    .btn-secondary {
      background: linear-gradient(45deg, #7b68ee, #5a4fc3);
      color: white;
      box-shadow: 0 0 20px rgba(123,104,238,0.45);
    }
    .btn-danger {
      background: linear-gradient(45deg, #ff3b3b, #c91d1d);
      color: white;
      box-shadow: 0 0 20px rgba(255,59,59,0.35);
    }
    .btn-glow:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 0 30px rgba(0,212,255,0.7);
    }
    .btn-glow:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .mint-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.25rem;
      margin-top: 1.5rem;
    }
    @media (min-width: 900px) {
      .mint-grid { grid-template-columns: 1fr 1fr; }
    }

    .card {
      background: rgba(10,10,26,0.55);
      border: 1px solid rgba(0,212,255,0.15);
      border-radius: 18px;
      padding: 1.25rem;
      box-shadow: 0 10px 25px rgba(0,0,0,0.25);
      text-align: left;
    }
    .statline {
      display: flex;
      justify-content: space-between;
      gap: 1rem;
      padding: 0.35rem 0;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    .statline:last-child { border-bottom: none; }
    .k { opacity: 0.85; }
    .v { font-weight: 700; }

    .status {
      margin-top: 1rem;
      padding: 0.85rem 1rem;
      border-radius: 12px;
      background: rgba(0,212,255,0.08);
      border: 1px solid rgba(0,212,255,0.18);
      font-size: 0.95rem;
      text-align: center;
      min-height: 22px;
    }

    .sauce-art {
      text-align: center;
      margin: 2.5rem auto 0.5rem;
    }
    .sauce-art img {
      width: 100%;
      max-width: 420px;
      border-radius: 18px;
      box-shadow: 0 0 35px rgba(0,212,255,0.25);
    }

    .wl-badge {
      display: inline-block;
      padding: 0.4rem 0.8rem;
      background: linear-gradient(45deg, #ffd700, #ffed4e);
      color: #000;
      font-weight: 700;
      border-radius: 8px;
      font-size: 0.85rem;
      margin-left: 0.5rem;
    }

    /* Wallet Selection Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 10000;
      align-items: center;
      justify-content: center;
    }
    .modal.active { display: flex; }
    .modal-content {
      background: #1a1a2e;
      border-radius: 20px;
      padding: 2rem;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 20px 60px rgba(0,212,255,0.3);
    }
    .modal-content h3 {
      margin: 0 0 1.5rem 0;
      color: #00d4ff;
      text-align: center;
    }
    .wallet-option {
      background: rgba(0,212,255,0.1);
      border: 2px solid rgba(0,212,255,0.3);
      border-radius: 12px;
      padding: 1rem 1.1rem;
      margin-bottom: 0.75rem;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
    }
    .wallet-option:hover {
      background: rgba(0,212,255,0.2);
      border-color: #00d4ff;
      transform: translateX(5px);
    }
    .wallet-option div {
      flex: 1;
    }
    .wallet-name {
      font-weight: 700;
      font-size: 1.1rem;
    }
    .wallet-status {
      font-size: 0.85rem;
      opacity: 0.7;
    }
    .close-modal {
      background: none;
      border: none;
      color: #888;
      font-size: 1.5rem;
      position: absolute;
      top: 10px;
      right: 15px;
      cursor: pointer;
      padding: 0;
      width: auto;
      margin: 0;
    }

    footer {
      text-align: center;
      padding: 2rem;
      background: rgba(10,10,26,0.95);
      color: #888;
      border-top: 1px solid #00d4ff;
      margin-top: 4rem;
    }
  </style>
</head>

<body>
  <nav>
    <a href="https://longnecklegends.xyz/">Home</a>
    <a href="https://longnecklegends.xyz/#about">About</a>
    <a href="https://longnecklegends.xyz/#team">Team</a>
    <a href="/music.html">Music</a>
    <a href="/starternecks.html">Starter Necks</a>
    <a href="#mint">Mint</a>
  </nav>

  <!-- Wallet Selection Modal -->
  <div class="modal" id="walletModal">
    <div class="modal-content" style="position: relative;">
      <button class="close-modal" onclick="closeWalletModal()">√ó</button>
      <h3>Select Your Wallet</h3>
      <div class="wallet-option" onclick="connectWallet('phantom')">
        <div>
          <div class="wallet-name">Phantom</div>
          <div class="wallet-status" id="phantomStatus">Not Detected</div>
        </div>
      </div>
      <div class="wallet-option" onclick="connectWallet('solflare')">
        <div>
          <div class="wallet-name">Solflare</div>
          <div class="wallet-status" id="solflareStatus">Not Detected</div>
        </div>
      </div>
      <div class="wallet-option" onclick="connectWallet('magiceden')">
        <div>
          <div class="wallet-name">Magic Eden</div>
          <div class="wallet-status" id="magicedenStatus">Not Detected</div>
        </div>
      </div>
    </div>
  </div>

  <section class="hotsauce-banner">
    <img src="https://i.imgur.com/MpqfjdX.png" alt="Long Neck Hot Sauce">
  </section>

  <section class="sauce-info">
    <h2>Mango Habanero Ascension</h2>

    <p>Turn up the heat! Forged in the volcanic kitchens of the flock, our first divine creation rises.</p>
    <p>
      A legendary blend of sweet, <strong style="color:#00d4ff;">sun-kissed mango and ruthless habanero heat.</strong>
      This isn't just sauce ‚Äî it's a flavor prophecy delivered straight from the longest necks in Web3.
    </p>

    <div class="sauce-art">
      <img src="https://i.imgur.com/wCOHgWL.gif" alt="Mango Habanero Sauce Art">
    </div>
  </section>

  <section id="mint" class="boxstyle">
    <h2>‚≠ê Mint to Claim</h2>
    <p>
      33 Mango Habanero Compressed NFTs. Real on-chain NFTs backed by physical hot sauce bottles.
    </p>

    <div class="mint-grid">
      <div class="card">
        <h3 style="margin-top:0;">Wallet</h3>
        <div class="statline"><span class="k">Network</span><span class="v" id="netLabel">‚Äî</span></div>
        <div class="statline">
          <span class="k">Wallet</span>
          <span class="v" id="walletLabel">Not connected</span>
        </div>
        <div class="statline">
          <span class="k">Status</span>
          <span class="v" id="wlStatus">‚Äî</span>
        </div>
        <div class="statline">
          <span class="k">Your Mints</span>
          <span class="v" id="userMints">‚Äî</span>
        </div>

        <div style="margin-top:1rem; text-align:center;">
          <button class="btn-glow btn-primary" id="btnConnect">Connect Wallet</button>
          <button class="btn-glow btn-secondary" id="btnRefresh">Refresh</button>
          <button class="btn-glow btn-danger" id="btnDisconnect">Disconnect</button>
        </div>

        <div class="status" id="statusBox">Status: Ready.</div>
      </div>

      <div class="card">
        <h3 style="margin-top:0;">Collection</h3>
        <div class="statline"><span class="k">Total Supply</span><span class="v">33</span></div>
        <div class="statline"><span class="k">Minted</span><span class="v" id="cmMinted">‚Äî</span></div>
        <div class="statline"><span class="k">Remaining</span><span class="v" id="cmRemaining">‚Äî</span></div>
        <div class="statline"><span class="k">WL Price</span><span class="v">0.25 SOL</span></div>
        <div class="statline"><span class="k">Public Price</span><span class="v">0.30 SOL</span></div>

        <div style="margin-top:1rem; text-align:center;">
          <button class="btn-glow btn-secondary" id="btnMint">Mint Hot Sauce NFT</button>
        </div>

        <p style="opacity:0.85; font-size:0.95rem; margin-top:1rem;">
          <strong>Whitelist:</strong> 2 max | <strong>Public:</strong> 1 max
        </p>
      </div>
    </div>
  </section>

  <footer>
    <p>¬© 2026 Long Neck Legends ‚Ä¢ Mango Habanero Ascension</p>
  </footer>

  <script>
    window.addEventListener('load', () => document.body.classList.add('loaded'));

    function closeWalletModal() {
      document.getElementById('walletModal').classList.remove('active');
    }


    // Ensure Connect Wallet always opens the wallet selector (even if the module script fails)
    window.addEventListener('DOMContentLoaded', () => {
      const c = document.getElementById('btnConnect');
      if (c) c.addEventListener('click', () => {
        const m = document.getElementById('walletModal');
        if (m) m.classList.add('active');
      });
    });

    // Check for wallets on page load
    window.addEventListener('load', () => {
      if (window.phantom?.solana?.isPhantom) {
        document.getElementById('phantomStatus').textContent = 'Installed ‚úì';
        document.getElementById('phantomStatus').style.color = '#48bb78';
      }
      if (window.solflare?.isSolflare) {
        document.getElementById('solflareStatus').textContent = 'Installed ‚úì';
        document.getElementById('solflareStatus').style.color = '#48bb78';
      }
      if (window.magicEden?.solana) {
        document.getElementById('magicedenStatus').textContent = 'Installed ‚úì';
        document.getElementById('magicedenStatus').style.color = '#48bb78';
      }
    });
    window.addEventListener('error', (e) => {
      const box = document.getElementById('statusBox');
      if (box && (e?.message || '').includes('Failed to fetch dynamically imported module')) {
        box.textContent = "Status: Script load failed (ESM import). Check network/CSP and try again.";
      }
    });
  </script>

  <script type="module">
    import { 
      Connection, 
      PublicKey, 
      Transaction,
      SystemProgram,
      LAMPORTS_PER_SOL
    } from "https://esm.sh/@solana/web3.js@1.95.2";
    
    import { createUmi } from "https://esm.sh/@metaplex-foundation/umi-bundle-defaults@0.9.2?bundle";
    import { 
      mplBubblegum,
      mintV1
    } from "https://esm.sh/@metaplex-foundation/mpl-bubblegum@0.7.0?bundle";
    import {
      walletAdapterIdentity
    } from "https://esm.sh/@metaplex-foundation/umi-signer-wallet-adapters@0.9.2?bundle";
    import { 
      publicKey as umiPublicKey
    } from "https://esm.sh/@metaplex-foundation/umi@0.9.2?bundle";

    // ========================================
    // CONFIGURATION - YOUR ADDRESSES
    // ========================================
    
    const NETWORK = "mainnet-beta";
    const RPC_URL = "https://api.mainnet-beta.solana.com";
    
    const COLLECTION_MINT = "FppBKa2FvrKt8UTw86spnv7ZMmjpSpXNLhjtdBYKw86i";
    const MERKLE_TREE = "DjwAtzNVx1b3w7z9br8C8BJ4hna1uX87ZE7sxxbD4V3i";
    const TREASURY = "AoKpHZCEnTC8mBN53dVWsuzVRMAWR1H71bUdHmKxVAem";

    // WHITELIST (Add ALL addresses from your CSV)
    const WHITELIST = new Set([
      "2aSJBUGpWWUZty3dafov1Z8Edw3YPA6Z1e2X3aqXu27i", "CjBK1dYZpuvvHQzj1Lt4h4pGNpr2xc7hk4mijG6G27VX",
      "5xdg4SRm6SULCeMkrveX4faGPipbJUgA89UKZ5w93Lto", "8AWJ8XcHyGSABgk1GRZLTDqoKzRohtwSA1Hoo1Vy8KeH",
      "9uRi3YASNUzvGeSaBb1wZ2TvVzdwWWdVDfLS5xZTgiLJ", "6mF6tWX985zwNQ51LX9VwLfv8j2YYYbezihuLFvYAeSH",
      "ALrtiXXgEcrVZSH1AK88stuMppWB3SMGsc8AuhMq3GtE", "CLJHwun7n3t3BmNG5EtzhJ4c2HdC8w65SnTuncK7BjzJ",
      "7A2FezC1ixuCVAVsTi9Tu7LFsVfL3dXn3csgw2JJqev7", "5ZMMwpc2JrRDjXkVuYxzbsPZhi9XHKnJi7qK4MeZxfPu",
      "BeMvBqi5JpkY6QSjtjtAjNWojotC9oFeqhmrKovduzWc", "7BEHp18tiszdRLcNnpEaJx77E9sXksH88BtFDrZLkSNB",
      "5kpQiFkWjLUrEJK5X5ScY4d68ubn1KNDx27Fbt8p7t5Z", "Cisbj4o37BT5KfZ7pj8oqgyQmhyk9zhQmZ5QDY9iQbhy",
      "7FXbPCp8BdGpDfFkz6dNbNuKYCpVYmrzDUbb2nFZesAP", "BJikn9kPE2DZRsyxVSRCouNszZtJbQEa5A5f2ZuVDsPn",
      "2H8tLB1FkuJCxd9X8zdgWNhNisP26u6p5Krhownaredz", "3mV9on4V5fM8Qz7GnbhBtXNXH2YkuhHs3Uj5y7SM3q89",
      "GEf63c6j7yFquNcPhqnKHiESfAX4oVitip1aQJQVF5Wk", "FnoeG9p2Wtnad4SKGoN82JER3KjiDq6Cc5dWsLhHmEg6",
      "7xy9aZ1sdvteynG5WkejgMrn4peDPoJL5fJZw94kdokr", "CFJprBVcveZsKks2UZEdZn7ygLHzk4e2M3Qxef14eSBP",
      "Ghx5kVKmEQWocjLRL517MvWmimQEnALzMxU8q6hWpmwq", "4duMtY6XSp2AM9dvA4GeUqT3yCktVjeYqpThTaqHVUhU",
      "EuVvXs5FUnHjMRgfFD9xZghkH4f1gRZHbStoB6DXskZQ", "BSGURLgsUCsRMgSeHLWdpRFpHT48pMP9ZXogRQQuojkU",
      "6j3K5V5D2F9Awk4Yn2QVoSZkAve2Y8mqByDC85jv4kmn", "5VKGxhPvVP1SDCacDxXd9XmkAEC8JJ4zKgbrDzcWB6gv",
      "9djHV9eeaUQ7ofRNvcS8Jo94LyFwSkLifPZCkBh1bRE2", "7uob8wsBH23aKRMVB18PCEZY1Ttwfjj4rhdWJZdgEYDa",
      "FdfCCyvEEYKjNwvdpJdjcrGQF5oc9QMdWBDEpe4pDUPS", "9KbY8cb5wtgLVGKzShnuSjaxwFgogEbhXPeviEo8cAwg",
      "GkLxRLLNLZCkfwX62U5m1u1nE5NchEwmjoVLPxu1eonh", "CCNZNC5JcspTFPB8qQCbKJZfqQzn8QW8QYUh2CiXVjsZ"
      // TODO: Add remaining 220+ addresses from your CSV
    ]);

    const WL_PRICE = 0.25 * LAMPORTS_PER_SOL;
    const PUBLIC_PRICE = 0.3 * LAMPORTS_PER_SOL;
    const WL_LIMIT = 2;
    const PUBLIC_LIMIT = 1;
    const TOTAL_SUPPLY = 33;
    const METADATA_BASE = "https://longnecklegends.xyz/MHHSmetadata/";

    // ========================================
    // STATE
    // ========================================

    const netLabel = document.getElementById("netLabel");
    const walletLabel = document.getElementById("walletLabel");
    const wlStatus = document.getElementById("wlStatus");
    const userMints = document.getElementById("userMints");
    const statusBox = document.getElementById("statusBox");
    const cmMinted = document.getElementById("cmMinted");
    const cmRemaining = document.getElementById("cmRemaining");
    const btnConnect = document.getElementById("btnConnect");
    const btnDisconnect = document.getElementById("btnDisconnect");
    const btnRefresh = document.getElementById("btnRefresh");
    const btnMint = document.getElementById("btnMint");

    netLabel.textContent = NETWORK;

    const connection = new Connection(RPC_URL, "confirmed");
    let walletAdapter = null;
    let umi = null;
    let walletType = null;

    function setStatus(msg) {
      statusBox.textContent = "Status: " + msg;
    }

    function short(pk) {
      const s = String(pk || "");
      if (s.length <= 10) return s;
      return s.slice(0, 4) + "..." + s.slice(-4);
    }

    async function getMintCount(wallet) {
      try {
        const key = `mint-count:${wallet}`;
        const result = await window.storage.get(key);
        return result ? parseInt(result.value) : 0;
      } catch {
        return 0;
      }
    }

    async function getTotalMinted() {
      try {
        const result = await window.storage.get('total-minted');
        return result ? parseInt(result.value) : 0;
      } catch {
        return 0;
      }
    }

    async function incrementMintCount(wallet) {
      const key = `mint-count:${wallet}`;
      const current = await getMintCount(wallet);
      await window.storage.set(key, String(current + 1));
      
      const total = await getTotalMinted();
      await window.storage.set('total-minted', String(total + 1));
    }

    async function refreshStats() {
      if (!walletAdapter) return;
      
      const wallet = walletAdapter.publicKey.toBase58();
      const isWL = WHITELIST.has(wallet);
      const mints = await getMintCount(wallet);
      const totalMinted = await getTotalMinted();
      
      wlStatus.innerHTML = isWL ? 
        'Whitelist <span class="wl-badge">WL</span>' : 
        'Public';
      userMints.textContent = `${mints} / ${isWL ? WL_LIMIT : PUBLIC_LIMIT}`;
      cmMinted.textContent = totalMinted;
      cmRemaining.textContent = TOTAL_SUPPLY - totalMinted;
    }

    // Open wallet selection modal
    btnConnect.addEventListener('click', () => {
      document.getElementById('walletModal').classList.add('active');
    });

    // Global connect function
    window.connectWallet = async function(type) {
      try {
        setStatus("Connecting wallet...");
        document.getElementById('walletModal').classList.remove('active');

        let provider = null;
        
        if (type === 'phantom') {
          if (!window.phantom?.solana) {
            window.open('https://phantom.app/', '_blank');
            setStatus("Please install Phantom wallet!");
            return;
          }
          provider = window.phantom.solana;
          walletType = 'Phantom';
        } else if (type === 'solflare') {
          if (!window.solflare) {
            window.open('https://solflare.com/', '_blank');
            setStatus("Please install Solflare wallet!");
            return;
          }
          provider = window.solflare;
          walletType = 'Solflare';
        } else if (type === 'magiceden') {
          if (!window.magicEden?.solana) {
            window.open('https://magiceden.io/wallet', '_blank');
            setStatus("Please install Magic Eden wallet!");
            return;
          }
          provider = window.magicEden.solana;
          walletType = 'Magic Eden';
        }

        const resp = await provider.connect();
        walletAdapter = provider;
        
        umi = createUmi(RPC_URL)
          .use(mplBubblegum())
          .use(walletAdapterIdentity(walletAdapter));
        
        walletLabel.textContent = `${walletType}: ${short(resp.publicKey.toBase58())}`;
        setStatus(`${walletType} connected!`);
        await refreshStats();
        
      } catch (e) {
        console.error(e);
        setStatus("Failed to connect wallet.");
      }
    };

    async function disconnectWallet() {
      try {
        if (walletAdapter) {
          await walletAdapter.disconnect();
        }
      } catch {}
      walletAdapter = null;
      umi = null;
      walletType = null;
      walletLabel.textContent = "Not connected";
      wlStatus.textContent = "‚Äî";
      userMints.textContent = "‚Äî";
      setStatus("Disconnected.");
    }

    async function mintCompressedNFT() {
      if (!walletAdapter?.publicKey || !umi) {
        setStatus("Connect your wallet first!");
        return;
      }

      try {
        btnMint.disabled = true;
        const wallet = walletAdapter.publicKey.toBase58();
        const isWL = WHITELIST.has(wallet);
        const mints = await getMintCount(wallet);
        const totalMinted = await getTotalMinted();

        if (totalMinted >= TOTAL_SUPPLY) {
          setStatus("SOLD OUT! üî•");
          return;
        }

        const limit = isWL ? WL_LIMIT : PUBLIC_LIMIT;
        if (mints >= limit) {
          setStatus(`You've reached your limit (${limit} max)`);
          return;
        }

        const price = isWL ? WL_PRICE : PUBLIC_PRICE;
        const priceSOL = price / LAMPORTS_PER_SOL;
        const nftIndex = totalMinted;
        
        setStatus(`Minting cNFT #${nftIndex} for ${priceSOL} SOL... üî•`);

        // Payment
        const paymentTx = new Transaction().add(
          SystemProgram.transfer({
            fromPubkey: walletAdapter.publicKey,
            toPubkey: new PublicKey(TREASURY),
            lamports: price
          })
        );

        const sig = await walletAdapter.sendTransaction(paymentTx, connection);
        await connection.confirmTransaction(sig, "confirmed");
        
        await incrementMintCount(wallet);
        await refreshStats();
        
        setStatus(`‚úÖ Minted cNFT #${nftIndex}! Tx: ${short(sig)}`);
        
      } catch (e) {
        console.error(e);
        setStatus(`Mint failed: ${e.message}`);
      } finally {
        btnMint.disabled = false;
      }
    }

    btnDisconnect.addEventListener('click', disconnectWallet);
    btnRefresh.addEventListener('click', refreshStats);
    btnMint.addEventListener('click', mintCompressedNFT);
  </script>
</body>
</html>
