<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" type="image/png" sizes="32x32" href="https://i.imgur.com/jpGdtHJ.jpeg">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LNL Holder Dashboard | Long Neck Legends</title>

  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Orbitron:wght@400;700;900&family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Space Grotesk', sans-serif;
      background: #0a0a1a;
      color: #e0e0ff;
      overflow-x: hidden;
      opacity: 0;
      transition: opacity 0.8s ease;
    }
    body.loaded { opacity: 1; }

    /* ---- NAV ---- */
    nav {
      position: fixed;
      top: 0;
      width: 100%;
      padding: 1rem 0;
      background: rgba(10,10,26,0.9);
      backdrop-filter: blur(10px);
      z-index: 1000;
      text-align: center;
    }
    nav a {
      color: #e0e0ff;
      margin: 0 1.5rem;
      text-decoration: none;
      font-weight: 600;
      position: relative;
      font-size: 0.9rem;
    }
    nav a::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 0;
      height: 2px;
      background: #00d4ff;
      transition: 0.3s;
    }
    nav a:hover::after { width: 100%; }

    /* ---- HERO ---- */
    .hero {
      margin-top: 60px;
      padding: 4rem 2rem 2.5rem;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    .hero::before {
      content: 'HOLDER';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-family: 'Bebas Neue', sans-serif;
      font-size: clamp(120px, 20vw, 400px);
      color: rgba(0,212,255,0.03);
      pointer-events: none;
      white-space: nowrap;
      letter-spacing: 20px;
    }
    .hero h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: clamp(1.6rem, 4vw, 2.8rem);
      font-weight: 900;
      letter-spacing: 3px;
      margin-bottom: 0.5rem;
    }
    .hero h1 span { color: #00d4ff; text-shadow: 0 0 30px rgba(0,212,255,0.4); }
    .hero-sub {
      color: #888;
      font-size: 0.95rem;
    }

    /* ---- CONNECT SECTION ---- */
    .connect-section {
      text-align: center;
      padding: 4rem 2rem;
    }
    .connect-btn {
      background: linear-gradient(135deg, #00d4ff 0%, #7b68ee 100%);
      color: #000;
      border: none;
      padding: 16px 48px;
      font-weight: 700;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 3px;
      cursor: pointer;
      font-family: 'Space Grotesk', sans-serif;
      border-radius: 4px;
      transition: all 0.3s;
      box-shadow: 0 4px 30px rgba(0,212,255,0.3);
    }
    .connect-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 40px rgba(0,212,255,0.5);
    }
    .connect-prompt {
      color: #555;
      margin-top: 1rem;
      font-size: 0.8rem;
      letter-spacing: 1px;
    }

    /* ---- DASHBOARD GRID ---- */
    .dashboard {
      display: none;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem 4rem;
      gap: 1.5rem;
    }
    .dashboard.show { display: grid; grid-template-columns: 1fr 1fr; }

    @media (max-width: 800px) {
      .dashboard.show { grid-template-columns: 1fr; }
    }

    /* ---- TIER CARD ---- */
    .tier-card {
      grid-column: 1 / -1;
      background: linear-gradient(135deg, #111125 0%, #0d0d20 100%);
      border: 1px solid #1e1e3a;
      border-radius: 16px;
      padding: 2.5rem;
      display: flex;
      align-items: center;
      gap: 2.5rem;
      position: relative;
      overflow: hidden;
    }
    .tier-card::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -20%;
      width: 400px;
      height: 400px;
      border-radius: 50%;
      opacity: 0.08;
      pointer-events: none;
    }
    .tier-card.tier-neck::before { background: radial-gradient(circle, #00d4ff, transparent); }
    .tier-card.tier-longneck::before { background: radial-gradient(circle, #7b68ee, transparent); }
    .tier-card.tier-legend::before { background: radial-gradient(circle, #ffd700, transparent); }
    .tier-card.tier-og::before { background: radial-gradient(circle, #ff3c5c, transparent); }
    .tier-card.tier-whale::before { background: radial-gradient(circle, #00ffcc, transparent); }

    @media (max-width: 600px) {
      .tier-card { flex-direction: column; text-align: center; padding: 2rem 1.5rem; }
    }

    .tier-badge {
      width: 130px;
      height: 130px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      position: relative;
      font-family: 'Orbitron', sans-serif;
      font-weight: 900;
      font-size: 1.8rem;
    }
    .tier-badge::after {
      content: '';
      position: absolute;
      inset: -3px;
      border-radius: 50%;
      border: 2px solid;
      animation: tierPulse 2s ease-in-out infinite;
    }
    @keyframes tierPulse {
      0%, 100% { opacity: 0.4; transform: scale(1); }
      50% { opacity: 0.8; transform: scale(1.05); }
    }

    .tier-neck .tier-badge { background: rgba(0,212,255,0.1); color: #00d4ff; }
    .tier-neck .tier-badge::after { border-color: #00d4ff; }
    .tier-longneck .tier-badge { background: rgba(123,104,238,0.1); color: #7b68ee; }
    .tier-longneck .tier-badge::after { border-color: #7b68ee; }
    .tier-legend .tier-badge { background: rgba(255,215,0,0.1); color: #ffd700; }
    .tier-legend .tier-badge::after { border-color: #ffd700; }
    .tier-og .tier-badge { background: rgba(255,60,92,0.1); color: #ff3c5c; }
    .tier-og .tier-badge::after { border-color: #ff3c5c; }
    .tier-whale .tier-badge { background: rgba(0,255,204,0.1); color: #00ffcc; }
    .tier-whale .tier-badge::after { border-color: #00ffcc; }

    .tier-info { flex: 1; }
    .tier-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 3px;
      color: #555;
      margin-bottom: 0.3rem;
    }
    .tier-name {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 2.8rem;
      letter-spacing: 4px;
      line-height: 1;
      margin-bottom: 0.3rem;
    }
    .tier-neck .tier-name { color: #00d4ff; }
    .tier-longneck .tier-name { color: #7b68ee; }
    .tier-legend .tier-name { color: #ffd700; }
    .tier-og .tier-name { color: #ff3c5c; }
    .tier-whale .tier-name { color: #00ffcc; }

    .tier-nfts-held {
      color: #888;
      font-size: 0.85rem;
      margin-bottom: 1rem;
    }
    .tier-nfts-held strong { color: #e0e0ff; font-weight: 700; }

    .tier-progress-wrap {
      max-width: 300px;
    }
    .tier-progress-label {
      display: flex;
      justify-content: space-between;
      font-size: 0.7rem;
      color: #555;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 6px;
    }
    .tier-progress-bar {
      height: 6px;
      background: rgba(255,255,255,0.06);
      border-radius: 3px;
      overflow: hidden;
    }
    .tier-progress-fill {
      height: 100%;
      border-radius: 3px;
      transition: width 1s cubic-bezier(0.16, 1, 0.3, 1);
    }
    .tier-neck .tier-progress-fill { background: #00d4ff; box-shadow: 0 0 10px rgba(0,212,255,0.5); }
    .tier-longneck .tier-progress-fill { background: #7b68ee; box-shadow: 0 0 10px rgba(123,104,238,0.5); }
    .tier-legend .tier-progress-fill { background: #ffd700; box-shadow: 0 0 10px rgba(255,215,0,0.5); }
    .tier-og .tier-progress-fill { background: #ff3c5c; box-shadow: 0 0 10px rgba(255,60,92,0.5); }
    .tier-whale .tier-progress-fill { background: #00ffcc; box-shadow: 0 0 10px rgba(0,255,204,0.5); }

    @media (max-width: 600px) {
      .tier-progress-wrap { max-width: 100%; margin: 0 auto; }
    }

    /* ---- STATS CARD ---- */
    .stats-card {
      background: #111125;
      border: 1px solid #1e1e3a;
      border-radius: 14px;
      padding: 2rem;
    }
    .stats-title {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 1.3rem;
      letter-spacing: 3px;
      color: #555;
      margin-bottom: 1.2rem;
    }

    .stat-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.7rem 0;
      border-bottom: 1px solid rgba(255,255,255,0.04);
    }
    .stat-row:last-child { border-bottom: none; }
    .stat-label {
      color: #888;
      font-size: 0.8rem;
    }
    .stat-value {
      font-weight: 700;
      font-size: 1.1rem;
    }
    .stat-value.cyan { color: #00d4ff; }
    .stat-value.purple { color: #7b68ee; }
    .stat-value.gold { color: #ffd700; }
    .stat-value.green { color: #00ff88; }

    /* ---- POINTS DISPLAY ---- */
    .points-display {
      text-align: center;
      padding: 1.5rem 0;
    }
    .points-number {
      font-family: 'Orbitron', sans-serif;
      font-size: 3.5rem;
      font-weight: 900;
      background: linear-gradient(135deg, #00d4ff, #7b68ee);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      line-height: 1;
    }
    .points-label {
      font-size: 0.7rem;
      letter-spacing: 3px;
      color: #555;
      text-transform: uppercase;
      margin-top: 0.3rem;
    }

    /* ---- PERKS CARD ---- */
    .perks-card {
      grid-column: 1 / -1;
      background: #111125;
      border: 1px solid #1e1e3a;
      border-radius: 14px;
      padding: 2rem;
    }
    .perks-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    .perk {
      background: rgba(0,0,0,0.3);
      border: 1px solid #1e1e3a;
      border-radius: 10px;
      padding: 1.2rem;
      position: relative;
      transition: all 0.3s;
    }
    .perk.unlocked {
      border-color: rgba(0,212,255,0.3);
      background: rgba(0,212,255,0.04);
    }
    .perk.locked {
      opacity: 0.4;
    }
    .perk-icon {
      font-size: 1.8rem;
      margin-bottom: 0.6rem;
    }
    .perk-name {
      font-weight: 700;
      font-size: 0.85rem;
      margin-bottom: 0.3rem;
      letter-spacing: 0.5px;
    }
    .perk-desc {
      color: #666;
      font-size: 0.72rem;
      line-height: 1.5;
    }
    .perk-req {
      font-size: 0.65rem;
      color: #555;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-top: 0.6rem;
    }
    .perk-req.met { color: #00ff88; }
    .perk-status {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }
    .perk-status.on {
      background: #00ff88;
      box-shadow: 0 0 8px rgba(0,255,136,0.6);
    }
    .perk-status.off {
      background: #333;
    }

    /* ---- NFT GALLERY ---- */
    .gallery-card {
      grid-column: 1 / -1;
      background: #111125;
      border: 1px solid #1e1e3a;
      border-radius: 14px;
      padding: 2rem;
    }
    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    .nft-tile {
      background: #0a0a1a;
      border: 1px solid #1e1e3a;
      border-radius: 10px;
      overflow: hidden;
      transition: all 0.3s;
      cursor: pointer;
    }
    .nft-tile:hover {
      transform: translateY(-4px);
      border-color: rgba(0,212,255,0.4);
      box-shadow: 0 8px 30px rgba(0,212,255,0.15);
    }
    .nft-tile img {
      width: 100%;
      aspect-ratio: 1;
      object-fit: cover;
      display: block;
    }
    .nft-tile-info {
      padding: 0.7rem;
    }
    .nft-tile-name {
      font-weight: 700;
      font-size: 0.75rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .nft-tile-id {
      color: #555;
      font-size: 0.65rem;
      margin-top: 2px;
    }

    /* ---- SHARE CARD ---- */
    .share-section {
      grid-column: 1 / -1;
      text-align: center;
      padding: 1rem 0;
    }
    .share-btn {
      background: transparent;
      border: 1px solid #1e1e3a;
      color: #888;
      padding: 10px 28px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 2px;
      cursor: pointer;
      font-family: 'Space Grotesk', sans-serif;
      transition: all 0.2s;
      border-radius: 4px;
    }
    .share-btn:hover {
      border-color: #00d4ff;
      color: #00d4ff;
      box-shadow: 0 0 20px rgba(0,212,255,0.15);
    }

    /* ---- NO NFTS STATE ---- */
    .no-nfts {
      grid-column: 1 / -1;
      text-align: center;
      padding: 3rem 2rem;
      background: #111125;
      border: 1px solid #1e1e3a;
      border-radius: 14px;
    }
    .no-nfts h2 {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 2rem;
      letter-spacing: 3px;
      margin-bottom: 0.5rem;
    }
    .no-nfts p {
      color: #666;
      margin-bottom: 1.5rem;
      font-size: 0.9rem;
    }
    .no-nfts a {
      display: inline-block;
      background: linear-gradient(135deg, #00d4ff, #7b68ee);
      color: #000;
      text-decoration: none;
      padding: 12px 36px;
      font-weight: 700;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 2px;
      border-radius: 4px;
      transition: all 0.2s;
    }
    .no-nfts a:hover {
      box-shadow: 0 4px 30px rgba(0,212,255,0.4);
      transform: translateY(-2px);
    }

    /* ---- LOADING ---- */
    .loading-spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 3px solid rgba(0,212,255,0.15);
      border-top-color: #00d4ff;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-bottom: 1rem;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .loading-text {
      color: #555;
      font-size: 0.8rem;
      letter-spacing: 2px;
      text-transform: uppercase;
    }

    /* ---- DISCONNECT BAR ---- */
    .wallet-bar {
      display: none;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      padding: 0.8rem 2rem;
      background: rgba(17,17,37,0.8);
      border-bottom: 1px solid #1e1e3a;
      flex-wrap: wrap;
    }
    .wallet-bar.show { display: flex; }
    .wallet-addr {
      color: #888;
      font-size: 0.8rem;
    }
    .wallet-addr strong { color: #e0e0ff; }
    .disconnect-btn {
      background: transparent;
      border: 1px solid #1e1e3a;
      color: #666;
      padding: 5px 14px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      font-family: 'Space Grotesk', sans-serif;
      transition: all 0.2s;
    }
    .disconnect-btn:hover { border-color: #ff3c5c; color: #ff3c5c; }
    .wallet-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #00ff88;
      box-shadow: 0 0 8px rgba(0,255,136,0.6);
    }

    /* ---- FOOTER ---- */
    footer {
      text-align: center;
      padding: 3rem 2rem;
      border-top: 1px solid #1e1e3a;
      color: #333;
      font-size: 0.7rem;
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    /* ---- SCROLLBAR ---- */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #0a0a1a; }
    ::-webkit-scrollbar-thumb { background: #1e1e3a; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #00d4ff; }

    @media (max-width: 600px) {
      nav a { margin: 0 0.8rem; font-size: 0.75rem; }
      .perks-grid { grid-template-columns: 1fr 1fr; }
      .gallery-grid { grid-template-columns: repeat(2, 1fr); }
      .points-number { font-size: 2.5rem; }
    }
  </style>
</head>
<body>
  <nav>
    <a href="https://longnecklegends.xyz/">Home</a>
    <a href="/starternecks.html">Starter Necks</a>
    <a href="/music.html">Music</a>
    <a href="/hotsaucemint.html">Hot Sauce</a>
    <a href="/store.html">Store</a>
  </nav>

  <section class="hero">
    <h1>HOLDER <span>DASHBOARD</span></h1>
    <p class="hero-sub">Connect your wallet to see your tier, points, and perks</p>
  </section>

  <!-- WALLET BAR -->
  <div class="wallet-bar" id="walletBar">
    <div class="wallet-dot"></div>
    <span class="wallet-addr"><strong id="walletDisplay">â€”</strong></span>
    <button class="disconnect-btn" onclick="disconnectWallet()">Disconnect</button>
  </div>

  <!-- CONNECT PROMPT -->
  <div class="connect-section" id="connectSection">
    <button class="connect-btn" onclick="connectWallet()">CONNECT WALLET</button>
    <p class="connect-prompt">Phantom &bull; Solflare &bull; Backpack</p>
  </div>

  <!-- LOADING -->
  <div class="connect-section" id="loadingSection" style="display:none;">
    <div class="loading-spinner"></div>
    <p class="loading-text">Scanning your wallet...</p>
  </div>

  <!-- DASHBOARD -->
  <div class="dashboard" id="dashboard">
    <!-- Tier card injected by JS -->
    <!-- Stats cards injected by JS -->
    <!-- Perks injected by JS -->
    <!-- Gallery injected by JS -->
  </div>

  <footer>
    <p>&copy; 2026 Long Neck Legends &bull; Diamond Hands Only</p>
  </footer>

  <script>
    window.addEventListener('load', function() { document.body.classList.add('loaded'); });

    var CONFIG = {
      COLLECTION_MINT: "8Rt3Ayqth4DAiPnW9MDFi63TiQJHmohfTWLMQFHi4KZH",
      RPC_URL: "https://mainnet.helius-rpc.com/?api-key=44cfd082-9089-430d-8de3-cd310c478b1c",
      MAGIC_EDEN_LINK: "https://magiceden.us/marketplace/long_neck_legends"
    };

    var TIERS = [
      { id: "civilian", name: "CIVILIAN", min: 0, icon: "\u{1F464}", pointsMultiplier: 0, discount: 0, raffleMultiplier: 0, cssClass: "" }, // ðŸ‘¤
      { id: "neck", name: "NECK", min: 1, icon: "\u{1F992}", pointsMultiplier: 1, discount: 10, raffleMultiplier: 1, cssClass: "tier-neck" }, // ðŸ¦’
      { id: "longneck", name: "LONG NECK", min: 5, icon: "\u{1F525}", pointsMultiplier: 1.5, discount: 15, raffleMultiplier: 2, cssClass: "tier-longneck" }, // ðŸ”¥
      { id: "legend", name: "LEGEND", min: 10, icon: "\u{2B50}", pointsMultiplier: 2.5, discount: 20, raffleMultiplier: 3, cssClass: "tier-legend" }, // â­
      { id: "og", name: "OG LEGEND", min: 20, icon: "\u{1F451}", pointsMultiplier: 4, discount: 25, raffleMultiplier: 5, cssClass: "tier-og" }, // ðŸ‘‘
      { id: "sardine", name: "SARDINE", min: 30, icon: "\u{1F41F}", pointsMultiplier: 6, discount: 30, raffleMultiplier: 6, cssClass: "tier-sardine" }, // ðŸŸ
      { id: "barracuda", name: "BARRACUDA", min: 50, icon: "\u{1F988}", pointsMultiplier: 7, discount: 35, raffleMultiplier: 7, cssClass: "tier-barracuda" }, // ðŸ¦ˆ (aggressive predator vibe)
      { id: "shark", name: "SHARK", min: 75, icon: "\u{1F52A}", pointsMultiplier: 8, discount: 35, raffleMultiplier: 8, cssClass: "tier-shark" }, // ðŸ”ª (apex energy)
      { id: "whale", name: "WHALE", min: 100, icon: "\u{1F40B}", pointsMultiplier: 10, discount: 40, raffleMultiplier: 10, cssClass: "tier-whale" } // ðŸ‹
    ];

    var PERKS = [
      { icon: "\u{1F992}", name: "Store Discount", desc: "Get a discount on all LNL Store purchases paid in SOL", reqTier: "neck", dynamic: true },
      { icon: "\u{1F992}", name: "Raffle Entries", desc: "Earn entries into exclusive drops, giveaways, and raffles", reqTier: "neck", dynamic: true },
      { icon: "\u{1F992}", name: "IRL Access", desc: "Entry to LNL events, listening parties, and tastings", reqTier: "neck" },
      { icon: "\u{1F525}", name: "Exclusive Merch", desc: "Unlock holder-only merch that never hits the public store", reqTier: "longneck" },
      { icon: "\u{2B50}", name: "Exclusive Merch", desc: "Vote on the next apparel drop. Your neck, your choice.", reqTier: "legend" },
      { icon: "\u{2B50}", name: "Flavor Voting", desc: "Vote on the next hot sauce flavor. Your taste, your choice.", reqTier: "legend" },
      { icon: "\u{1F451}", name: "Early Access", desc: "Get first dibs on new sauce flavors, merch drops, and collections", reqTier: "og" },
      { icon: "\u{1F451}", name: "VIP IRL Access", desc: "VIP entry to LNL events, listening parties, and tastings", reqTier: "og" },
      { icon: "\u{1F41F}", name: "Diamond Hands Club", desc: "Private group with alpha, airdrops, and direct team access", reqTier: "sardine" },
      { icon: "\u{1F988}", name: "Monthly Airdrop", desc: "Free products, NFTs, and surprises delivered monthly", reqTier: "barracuda" },
      { icon: "\u{1F52A}", name: "Shark Council", desc: "Direct input on project direction, partnerships, and roadmap decisions", reqTier: "shark" },
      { icon: "\u{1F40B}", name: "Lifetime Perks", desc: "Permanent max discount, first priority on all future drops, and custom merch", reqTier: "whale" }
    ];

    var walletProvider = null;
    var walletPublicKey = null;
    var sdkLoaded = false;
    var SolanaWeb3 = null;
    var MetaplexJS = null;

    function getTier(count) {
      for (var i = TIERS.length - 1; i >= 0; i--) {
        if (count >= TIERS[i].min) return TIERS[i];
      }
      return TIERS[0];
    }
    function getNextTier(tier) {
      var idx = TIERS.findIndex(function(t) { return t.id === tier.id; });
      return idx < TIERS.length - 1 ? TIERS[idx + 1] : null;
    }
    function calcPoints(count, tier) {
      return Math.floor(count * 100 * tier.pointsMultiplier);
    }

    async function loadSDK() { return true; }

    function detectWalletProvider() {
      if (window.phantom && window.phantom.solana && window.phantom.solana.isPhantom) return window.phantom.solana;
      if (window.backpack && window.backpack.solana) return window.backpack.solana;
      if (window.solflare && window.solflare.isSolflare) return window.solflare;
      if (window.solflare && window.solflare.solana) return window.solflare.solana;
      if (window.solana && window.solana.isPhantom) return window.solana;
      if (window.solana) return window.solana;
      return null;
    }

    async function connectWallet() {
      console.log("Connect clicked");
      var provider = detectWalletProvider();
      console.log("Provider:", provider);
      if (!provider || typeof provider.connect !== "function") {
        alert("No compatible Solana wallet found. Install Phantom, Solflare, or Backpack.");
        return;
      }
      try {
        if (provider.isConnected && typeof provider.disconnect === "function") {
          try { await provider.disconnect(); } catch (e) {}
        }
        var resp = await provider.connect({ onlyIfTrusted: false });
        walletProvider = provider;
        walletPublicKey = resp.publicKey || provider.publicKey;
        if (!walletPublicKey) throw new Error("Wallet connected but no publicKey found.");
        console.log("Connected:", walletPublicKey.toBase58());

        var addr = walletPublicKey.toBase58();
        document.getElementById("walletDisplay").textContent = addr.slice(0, 4) + "..." + addr.slice(-4);
        document.getElementById("connectSection").style.display = "none";
        document.getElementById("loadingSection").style.display = "block";
        document.getElementById("walletBar").classList.add("show");

        var ok = await loadSDK();
        if (!ok) {
          document.getElementById("loadingSection").style.display = "none";
          document.getElementById("connectSection").style.display = "block";
          return;
        }

        await loadDashboard();
      } catch (err) {
        console.error("Connect error:", err);
        alert("Connection error: " + (err.message || err));
      }
    }

    function disconnectWallet() {
      if (walletProvider && walletProvider.disconnect) walletProvider.disconnect();
      walletProvider = null;
      walletPublicKey = null;
      document.getElementById("connectSection").style.display = "block";
      document.getElementById("loadingSection").style.display = "none";
      document.getElementById("dashboard").classList.remove("show");
      document.getElementById("walletBar").classList.remove("show");
    }

    async function loadDashboard() {
      try {
        var owner = walletPublicKey.toBase58();
        var res = await fetch(CONFIG.RPC_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            jsonrpc: "2.0",
            id: "lnl",
            method: "getAssetsByOwner",
            params: {
              ownerAddress: owner,
              page: 1,
              limit: 1000,
              displayOptions: { showCollectionMetadata: true }
            }
          })
        });
        var json = await res.json();
        var items = (json && json.result && json.result.items) ? json.result.items : [];
        console.log("=== DASHBOARD DEBUG ===");
        console.log("DAS total assets:", items.length);
        console.log("Looking for collection:", CONFIG.COLLECTION_MINT);

        var lnlAssets = items.filter(function(a) {
          var groups = a.grouping || [];
          var g = groups.find(function(x) { return x.group_key === "collection"; });
          return g && g.group_value === CONFIG.COLLECTION_MINT;
        });

        var picked = lnlAssets.length > 0 ? lnlAssets : items.filter(function(a) {
          var sym = (a.content && a.content.metadata && a.content.metadata.symbol) ||
                    (a.content && a.content.json && a.content.json.symbol) || "";
          var name = (a.content && a.content.metadata && a.content.metadata.name) ||
                     (a.content && a.content.json && a.content.json.name) || "";
          return (sym === "LNL") || (name.toLowerCase().indexOf("long neck") !== -1);
        });

        console.log("Matched by collection:", lnlAssets.length);
        console.log("Final matched LNL assets:", picked.length);

        if (picked.length === 0) {
          var uniqueCollections = [];
          items.forEach(function(a) {
            var groups = a.grouping || [];
            groups.forEach(function(g) {
              if (g.group_key === "collection" && uniqueCollections.indexOf(g.group_value) === -1) {
                uniqueCollections.push(g.group_value);
              }
            });
          });
          console.log("All collections in wallet:", uniqueCollections);
          items.slice(0, 5).forEach(function(a, i) {
            console.log("Sample NFT " + i + ":", a.content && a.content.metadata ? a.content.metadata.name : "?", "| symbol:", a.content && a.content.metadata ? a.content.metadata.symbol : "?");
          });
        }
        console.log("========================");

        var loadedNFTs = picked.map(function(a) {
          var name = (a.content && a.content.metadata && a.content.metadata.name) ||
                     (a.content && a.content.json && a.content.json.name) || "LNL";
          var image = (a.content && a.content.links && a.content.links.image) ||
                      (a.content && a.content.files && a.content.files[0] && a.content.files[0].uri) ||
                      (a.content && a.content.json && a.content.json.image) || "";
          var mint = a.id || "";
          return { name: name, image: image, mint: mint };
        });

        document.getElementById("loadingSection").style.display = "none";
        renderDashboard(loadedNFTs);
      } catch (err) {
        console.error("Dashboard error:", err);
        document.getElementById("loadingSection").style.display = "none";
        document.getElementById("connectSection").style.display = "block";
        alert("Error loading NFTs: " + (err.message || err));
      }
    }

    function renderDashboard(nfts) {
      var dash = document.getElementById("dashboard");
      dash.innerHTML = "";
      var count = nfts.length;
      var tier = getTier(count);
      var nextTier = getNextTier(tier);
      var points = calcPoints(count, tier);

      if (count === 0) {
        dash.innerHTML = '<div class="no-nfts"><h2>NO LONG NECK LEGENDS FOUND</h2><p>You don\'t hold any LNL NFTs in this wallet. Cop one to unlock holder perks.</p><a href="' + CONFIG.MAGIC_EDEN_LINK + '" target="_blank">BUY ON MAGIC EDEN</a></div>';
        dash.classList.add("show");
        return;
      }

      var progressHTML = "";
      if (nextTier) {
        var progress = ((count - tier.min) / (nextTier.min - tier.min)) * 100;
        progressHTML = '<div class="tier-progress-wrap"><div class="tier-progress-label"><span>' + tier.name + '</span><span>' + nextTier.name + ' (' + nextTier.min + ' NFTs)</span></div><div class="tier-progress-bar"><div class="tier-progress-fill" style="width:' + Math.min(progress,100) + '%"></div></div></div>';
      } else {
        progressHTML = '<div style="color:#555;font-size:0.75rem;letter-spacing:2px;text-transform:uppercase;">MAX TIER REACHED \u{1F451}</div>';
      }

      dash.innerHTML += '<div class="tier-card ' + tier.cssClass + '"><div class="tier-badge">' + tier.icon + '</div><div class="tier-info"><div class="tier-label">YOUR TIER</div><div class="tier-name">' + tier.name + '</div><div class="tier-nfts-held">Holding <strong>' + count + '</strong> Long Neck Legend' + (count !== 1 ? "s" : "") + '</div>' + progressHTML + '</div></div>';

      dash.innerHTML += '<div class="stats-card"><div class="stats-title">LEGEND POINTS</div><div class="points-display"><div class="points-number">' + points.toLocaleString() + '</div><div class="points-label">Total Points</div></div><div class="stat-row"><span class="stat-label">Base (' + count + ' \u00D7 100)</span><span class="stat-value">' + (count*100) + '</span></div><div class="stat-row"><span class="stat-label">Tier Multiplier</span><span class="stat-value cyan">' + tier.pointsMultiplier + 'x</span></div><div class="stat-row"><span class="stat-label">Raffle Entries</span><span class="stat-value purple">' + (count * tier.raffleMultiplier) + '</span></div></div>';

      var nextTierRow = nextTier ? '<div class="stat-row"><span class="stat-label">Next Tier At</span><span class="stat-value gold">' + nextTier.min + ' NFTs</span></div>' : '<div class="stat-row"><span class="stat-label">Status</span><span class="stat-value gold">MAXED \u{1F451}</span></div>';

      dash.innerHTML += '<div class="stats-card"><div class="stats-title">YOUR STATS</div><div class="stat-row"><span class="stat-label">NFTs Held</span><span class="stat-value cyan">' + count + '</span></div><div class="stat-row"><span class="stat-label">Current Tier</span><span class="stat-value">' + tier.name + '</span></div><div class="stat-row"><span class="stat-label">Store Discount</span><span class="stat-value green">' + tier.discount + '%</span></div><div class="stat-row"><span class="stat-label">Raffle Multiplier</span><span class="stat-value purple">' + tier.raffleMultiplier + 'x</span></div>' + nextTierRow + '</div>';

      var tierOrder = TIERS.map(function(t) { return t.id; });
      var currentTierIdx = tierOrder.indexOf(tier.id);
      var perksHTML = PERKS.map(function(perk) {
        var reqIdx = tierOrder.indexOf(perk.reqTier);
        var unlocked = currentTierIdx >= reqIdx;
        var reqTierObj = TIERS.find(function(t) { return t.id === perk.reqTier; });
        var desc = perk.desc;
        if (perk.dynamic && perk.name === "Store Discount" && unlocked) desc = tier.discount + "% off all LNL Store purchases paid in SOL";
        if (perk.dynamic && perk.name === "Raffle Entries" && unlocked) desc = tier.raffleMultiplier + "x entries into every raffle and giveaway";
        return '<div class="perk ' + (unlocked ? "unlocked" : "locked") + '"><div class="perk-status ' + (unlocked ? "on" : "off") + '"></div><div class="perk-icon">' + perk.icon + '</div><div class="perk-name">' + perk.name + '</div><div class="perk-desc">' + desc + '</div><div class="perk-req ' + (unlocked ? "met" : "") + '">' + (unlocked ? "\u2713 UNLOCKED" : "REQUIRES " + reqTierObj.name) + '</div></div>';
      }).join("");

      dash.innerHTML += '<div class="perks-card"><div class="stats-title">HOLDER PERKS</div><div class="perks-grid">' + perksHTML + '</div></div>';

      var galleryHTML = nfts.map(function(nft) {
        var img = nft.image ? '<img src="' + nft.image + '" alt="' + nft.name + '" loading="lazy">' : '<div style="aspect-ratio:1;background:#1e1e3a;display:flex;align-items:center;justify-content:center;color:#555;font-size:0.8rem;">No Image</div>';
        var mintShort = nft.mint ? nft.mint.slice(0,4) + "..." + nft.mint.slice(-4) : "";
        return '<div class="nft-tile" onclick="window.open(\'https://magiceden.us/item-details/' + nft.mint + '\',\'_blank\')">' + img + '<div class="nft-tile-info"><div class="nft-tile-name">' + nft.name + '</div><div class="nft-tile-id">' + mintShort + '</div></div></div>';
      }).join("");

      dash.innerHTML += '<div class="gallery-card"><div class="stats-title">YOUR COLLECTION</div><div class="gallery-grid">' + galleryHTML + '</div></div>';

      var shareText = encodeURIComponent("\u{1F992} I'm a " + tier.name + " holder with " + count + " Long Neck Legend" + (count !== 1 ? "s" : "") + "!\n\n" + points + " Legend Points | " + tier.discount + "% store discount\n\nCheck your status: longnecklegends.xyz/dashboard");
      dash.innerHTML += '<div class="share-section"><button class="share-btn" onclick="window.open(\'https://twitter.com/intent/tweet?text=' + shareText + '\',\'_blank\')">SHARE ON X / TWITTER</button></div>';

      dash.classList.add("show");
    }
  </script>
</body>
</html>
