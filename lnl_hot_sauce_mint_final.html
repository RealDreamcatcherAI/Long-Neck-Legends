<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" type="image/png" sizes="32x32" href="https://i.imgur.com/jpGdtHJ.jpeg">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LNL Hot Sauce Mint | Mango Habanero Ascension</title>

  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    /* === ORIGINAL HOTSAUCE STYLE (UNCHANGED LOOK) === */
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, Helvetica, sans-serif;
      background: #0a0a1a;
      color: #e0e0ff;
      overflow-x: hidden;
    }

    nav {
      position: fixed;
      top: 0;
      width: 100%;
      padding: 1rem 0;
      background: rgba(10,10,26,0.9);
      backdrop-filter: blur(10px);
      z-index: 1000;
      text-align: center;
    }
    nav a { color:#e0e0ff; margin:0 1.5rem; text-decoration:none; font-weight:600; }

    .hotsauce-banner { padding-top: 90px; text-align: center; }
    .hotsauce-banner img { max-width: 800px; width:100%; }

    h2 {
      font-family: "Trebuchet MS", Helvetica, sans-serif;
      font-size: 3rem;
      background: linear-gradient(45deg, #00d4ff, #ff6bff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-align:center;
    }

    .boxstyle {
      margin: 3rem auto;
      padding: 2.5rem 2rem;
      max-width: 900px;
      background: rgba(20,20,40,0.6);
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,212,255,0.25);
    }
    
    /* ‚úÖ Prevent anything inside the box from spilling out */
.boxstyle{
  overflow:hidden;
}

/* ‚úÖ Sauce GIF stays centered + responsive */
.sauce-art{
  width:100%;
  display:flex;
  justify-content:center;
  align-items:center;
  margin: 2rem auto;
}

.sauce-art img{
  width:100%;
  max-width:520px;  /* üî• BIGGER GIF (change this anytime) */
  height:auto;
  display:block;
  margin:0 auto;
  border-radius:16px;
  box-shadow:0 0 25px rgba(0,212,255,0.35);
}

    .mint-grid { display:grid; grid-template-columns:1fr; gap:1.25rem; }
    @media(min-width:900px){ .mint-grid{grid-template-columns:1fr 1fr;} }

    .card {
      background: rgba(10,10,26,0.55);
      border-radius: 18px;
      padding: 1.25rem;
    }

    .statline { display:flex; justify-content:space-between; padding:.35rem 0; }

    .btn-glow {
      padding:1rem 2.5rem;
      border-radius:50px;
      font-weight:700;
      border:none;
      cursor:pointer;
      background:linear-gradient(45deg,#00d4ff,#0099cc);
      color:white;
      margin:.4rem;
    }
    .btn-secondary{background:linear-gradient(45deg,#7b68ee,#5a4fc3)}

    .status { margin-top:1rem; padding:.8rem; border-radius:12px; background:rgba(0,212,255,0.1); }

    /* Wallet Modal */
    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.85);z-index:9999;align-items:center;justify-content:center}
    .modal.active{display:flex}
    .modal-content{background:#1a1a2e;border-radius:20px;padding:2rem;width:90%;max-width:400px}
    .wallet-option{padding:1rem;border:2px solid rgba(0,212,255,.3);border-radius:12px;margin:.6rem 0;cursor:pointer}
    .wallet-option:hover{background:rgba(0,212,255,.15)}

    /* ‚úÖ Center text ONLY inside the Limited Edition Bottles section */
#bottle-info{
  text-align:center;
}

#bottle-info p{
  max-width: 720px;
  margin: 0.75rem auto;
  line-height: 1.6;
}

#bottle-info strong{
  display:inline-block;
}
  </style>
</head>

<body>
<nav>
    <a href="https://longnecklegends.xyz/">Home</a>
    <a href="https://longnecklegends.xyz/#about">About</a>
    <a href="https://longnecklegends.xyz/#team">Team</a>
    <a href="/music.html">Music</a>
    <a href="/starternecks.html">Starter Necks</a>
  </nav>

<!-- SAUCE HEADER IMAGE -->
<section id="sauce-header" style="text-align:center; padding-top:90px;" class="hotsauce-banner">
  <img 
    src="https://i.imgur.com/MpqfjdX.png" 
    alt="Long Neck Hot Sauce"
    style="
      width: 100%;
      max-width: 800px; 
      display: block; 
      margin: 0 auto;"
  >
</section>

    <!-- ABOUT -->
<section id="sauce-info" style="max-width:900px; margin:0 auto; text-align:center; font-size:1.15rem; max-width:800px; margin:0 auto;">
<h2>Mango Habanero Ascension
</h2>

<p>Turn up the heat! Forged in the volcanic kitchens of the flock, 
  our first divine creation rises.
</p>
  
<p>A legendary blend of sweet, <strong style="color:#00d4ff;">sun-kissed mango and ruthless habanero heat.</strong>
  This isn‚Äôt just sauce, it‚Äôs a flavor prophecy delivered straight 
  from the longest necks in Web3.
</p>

<p>Every drop hits like a tropical uppercut.
  Every taste feels like riding a <strong style="color:#00d4ff;">fire-breathing ostrich</strong> into battle.
  Your tongue will praise you. Your enemies will envy you,
  because legends deserve artifacts‚Ä¶
</p>
</section>

    <!-- BOTTLE INFO -->  
<section id="bottle-info" class="boxstyle">
<h2>‚≠ê Limited Edition Bottles
</h2>

<p>Each batch is sealed in exclusive, collector bottles featuring iconic 
  Long Necks. Once they‚Äôre gone, they‚Äôre gone forever! burned into 
  history like the spicy scriptures of our people.
</p>
  
<p>Only the <strong style="color:#00d4ff;">bravest</strong> will taste it.<br>
  Only the <strong style="color:#00d4ff;">chosen</strong> will collect it.<br>
  Only the <strong style="color:#00d4ff;">flock</strong> will understand its power.
</p>

<p><strong style="color:#00d4ff;">Supply - 33</strong>
  <br>
<p><strong style="color:#00d4ff;">LNL Holder - 0.25 SOL</strong>
  <br>
<p><strong style="color:#00d4ff;">Public - 0.3 SOL</strong>
  <br>
  <p>Free USA Shipping</p>
  <div class="sauce-art">
  <img src="https://i.imgur.com/wCOHgWL.gif" alt="Mango Habanero Hot Sauce Art">
</div>

<section id="mint" class="boxstyle">
  <h2>‚≠ê Mint to Claim</h2>

  <div class="mint-grid">
    <div class="card">
      <h3>Wallet</h3>
      <div class="statline"><span>Wallet</span><span id="walletLabel">Not connected</span></div>
      <div class="statline"><span>Status</span><span id="wlStatus">‚Äî</span></div>
      <div class="statline"><span>Your Mints</span><span id="userMints">‚Äî</span></div>

      <div style="text-align:center;margin-top:1rem">
        <button class="btn-glow" id="btnConnect">Connect Wallet</button>
      </div>

      <div class="status" id="statusBox">Ready.</div>
    </div>

    <div class="card">
      <h3>Collection</h3>
      <div class="statline"><span>Total</span><span>33</span></div>
      <div class="statline"><span>Minted</span><span id="minted">‚Äî</span></div>
      <div class="statline"><span>Remaining</span><span id="remaining">‚Äî</span></div>
      <div class="statline"><span>Price</span><span id="priceLabel">‚Äî</span></div>

      <div style="text-align:center;margin-top:1rem">
        <button class="btn-glow btn-secondary" id="btnMint">Mint Hot Sauce NFT</button>
      </div>

      <p style="margin-top:1rem"><b>WL:</b> 2 max ‚Ä¢ <b>Public:</b> 1 max</p>
    </div>
  </div>
</section>

<!-- WALLET MODAL -->
<div class="modal" id="walletModal">
  <div class="modal-content">
    <h3>Select Wallet</h3>
    <div class="wallet-option" onclick="connectWallet('phantom')">Phantom</div>
    <div class="wallet-option" onclick="connectWallet('solflare')">Solflare</div>
    <div class="wallet-option" onclick="connectWallet('magiceden')">Magic Eden</div>
  </div>
</div>

<script>
/* ===========================
   HOTSAUCE MINT SCRIPT (FIXED)
   - No module imports at page load
   - Dynamic imports only when needed
   - Buttons ALWAYS work
=========================== */

const RPC = "https://api.mainnet-beta.solana.com";
const COLLECTION_MINT = "FppBKa2FvrKt8UTw86spnv7ZMmjpSpXNLhjtdBYKw86i";
const MERKLE_TREE = "DjwAtzNVx1b3w7z9br8C8BJ4hna1uX87ZE7sxxbD4V3i";
const TREASURY = "AoKpHZCEnTC8mBN53dVWsuzVRMAWR1H71bUdHmKxVAem";
const METADATA_BASE = "https://longnecklegends.xyz/MHHSmetadata/";

const TOTAL_SUPPLY = 33;
const WL_PRICE = 0.25;
const PUBLIC_PRICE = 0.30;
const WL_LIMIT = 2;
const PUBLIC_LIMIT = 1;

// LNL Holder WL (Collection ID)
const LNL_COLLECTION = "2WvxCvgFUiqUSBx32c5Z5Zsbcu4ZJCE1GEaaWpbD685P";
const HELIUS = "https://rpc.helius.xyz/?api-key=free";

// UI refs
const walletLabel = document.getElementById("walletLabel");
const wlStatus = document.getElementById("wlStatus");
const userMints = document.getElementById("userMints");
const mintedLabel = document.getElementById("minted");
const remainingLabel = document.getElementById("remaining");
const priceLabel = document.getElementById("priceLabel");
const statusBox = document.getElementById("statusBox");
const walletModal = document.getElementById("walletModal");

let wallet = null;
let umi = null;
let connection = null;
let isWL = false;
let mintPrice = PUBLIC_PRICE;

// modules cache
let web3 = null;
let umiMods = null;

function setStatus(t){ statusBox.textContent = t; }

// ‚úÖ Always bind buttons even if libraries fail
document.getElementById("btnConnect").addEventListener("click", () => {
  walletModal.classList.add("active");
});

document.getElementById("btnMint").addEventListener("click", () => {
  mint().catch(e => {
    console.error(e);
    setStatus("Mint failed (see console)");
  });
});

// Click outside modal closes it
walletModal.addEventListener("click", (e) => {
  if(e.target === walletModal) walletModal.classList.remove("active");
});

priceLabel.textContent = PUBLIC_PRICE + " SOL";

// ------------------ Dynamic Imports ------------------
async function loadWeb3(){
  if(web3) return web3;

  setStatus("Loading Solana libraries‚Ä¶");
  web3 = await import("https://esm.sh/@solana/web3.js@1.95.2");
  connection = new web3.Connection(RPC, "confirmed");
  return web3;
}

async function loadUmi(){
  if(umiMods) return umiMods;

  setStatus("Loading mint engine‚Ä¶");
  const [
    umiBundle,
    bubblegum,
    walletId,
    umiCore
  ] = await Promise.all([
    import("https://esm.sh/@metaplex-foundation/umi-bundle-defaults@0.9.2"),
    import("https://esm.sh/@metaplex-foundation/mpl-bubblegum@0.7.0"),
    import("https://esm.sh/@metaplex-foundation/umi-signer-wallet-adapters@0.9.2"),
    import("https://esm.sh/@metaplex-foundation/umi@0.9.2"),
  ]);

  umiMods = { umiBundle, bubblegum, walletId, umiCore };
  return umiMods;
}

// ------------------ Wallet Connect ------------------
window.connectWallet = async function(type){
  try{
    let provider = null;

    // Phantom
    if(type === "phantom") provider = window.phantom?.solana;
    // Solflare
    if(type === "solflare") provider = window.solflare;
    // Magic Eden (optional)
    if(type === "magiceden") provider = window.magicEden?.solana;

    if(!provider){
      alert("Wallet not installed");
      return;
    }

    setStatus("Connecting wallet‚Ä¶");

    const resp = await provider.connect();
    wallet = provider;

    // UI label
    const pub = resp.publicKey.toBase58();
    walletLabel.textContent = pub.slice(0,4) + "..." + pub.slice(-4);

    // WL + supply
    await checkWhitelist(pub);
    await refreshSupply();
    refreshUserMints(pub);

    // Build UMI ONLY after wallet connects
    const { umiBundle, bubblegum, walletId } = await loadUmi();
    umi = umiBundle.createUmi(RPC)
      .use(bubblegum.mplBubblegum())
      .use(walletId.walletAdapterIdentity(wallet));

    walletModal.classList.remove("active");
    setStatus("Wallet connected üî•");

  } catch (e) {
    console.error(e);
    setStatus("Wallet connect failed (check console)");
  }
};

// ------------------ WL Check ------------------
async function checkWhitelist(pubkey){
  try{
    const res = await fetch(HELIUS,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({
        jsonrpc:"2.0",
        id:"wl",
        method:"getAssetsByOwner",
        params:{ ownerAddress:pubkey, page:1, limit:1000 }
      })
    });

    const json = await res.json();
    const assets = json?.result?.items || [];

    isWL = assets.some(a =>
      a.grouping?.some(g => g.group_value === LNL_COLLECTION)
    );

    wlStatus.textContent = isWL ? "Whitelist (LNL Holder)" : "Public";
    mintPrice = isWL ? WL_PRICE : PUBLIC_PRICE;
    priceLabel.textContent = mintPrice + " SOL";

  } catch(e) {
    console.error(e);
    isWL = false;
    mintPrice = PUBLIC_PRICE;
    wlStatus.textContent = "Public";
    priceLabel.textContent = PUBLIC_PRICE + " SOL";
  }
}

// ------------------ Local Mint Tracking ------------------
function refreshUserMints(walletStr){
  const key = "mints_" + walletStr;
  const used = parseInt(localStorage.getItem(key) || "0");
  const limit = isWL ? WL_LIMIT : PUBLIC_LIMIT;
  userMints.textContent = `${used} / ${limit}`;
}

function incrementUserMints(walletStr){
  const key = "mints_" + walletStr;
  const used = parseInt(localStorage.getItem(key) || "0") + 1;
  localStorage.setItem(key, String(used));
}

// ------------------ Supply ------------------
async function refreshSupply(){
  const { PublicKey } = await loadWeb3();

  try{
    const acct = await connection.getAccountInfo(new PublicKey(MERKLE_TREE));
    const minted = Math.min(acct.data.length % TOTAL_SUPPLY, TOTAL_SUPPLY);

    mintedLabel.textContent = minted;
    remainingLabel.textContent = TOTAL_SUPPLY - minted;
  } catch(e){
    console.error(e);
    mintedLabel.textContent = "‚Äî";
    remainingLabel.textContent = "‚Äî";
  }
}

// ------------------ Mint ------------------
async function mint(){
  if(!wallet){
    setStatus("Connect wallet first");
    return;
  }

  const pub = wallet.publicKey.toBase58();
  const used = parseInt(localStorage.getItem("mints_" + pub) || "0");
  const limit = isWL ? WL_LIMIT : PUBLIC_LIMIT;

  if(used >= limit){
    setStatus("Mint limit reached");
    return;
  }

  await refreshSupply();
  const index = Number(mintedLabel.textContent);

  if(Number.isNaN(index)){
    setStatus("Cannot read supply yet. Try again.");
    return;
  }

  if(index >= TOTAL_SUPPLY){
    setStatus("SOLD OUT üî•");
    return;
  }

  const { Transaction, SystemProgram, PublicKey, LAMPORTS_PER_SOL } = await loadWeb3();

  try{
    setStatus(`Paying ${mintPrice} SOL‚Ä¶`);

    const tx = new Transaction().add(
      SystemProgram.transfer({
        fromPubkey: wallet.publicKey,
        toPubkey: new PublicKey(TREASURY),
        lamports: Math.floor(mintPrice * LAMPORTS_PER_SOL)
      })
    );

    tx.feePayer = wallet.publicKey;
    tx.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;

    const signed = await wallet.signTransaction(tx);
    const sig = await connection.sendRawTransaction(signed.serialize());
    await connection.confirmTransaction(sig);

    // Mint cNFT
    setStatus("Minting cNFT‚Ä¶ üî•");

    const { bubblegum, umiCore } = await loadUmi();
    const uri = METADATA_BASE + index + ".json";

    await bubblegum.mintV1(umi, {
      leafOwner: umiCore.publicKey(pub),
      merkleTree: umiCore.publicKey(MERKLE_TREE),
      metadata: {
        name: `Mango Habanero Ascension #${index}`,
        uri,
        sellerFeeBasisPoints: 1000,
        collection: { key: umiCore.publicKey(COLLECTION_MINT), verified: false },
        creators: [{ address: umiCore.publicKey(TREASURY), verified: true, share: 100 }]
      }
    }).sendAndConfirm(umi);

    incrementUserMints(pub);
    refreshUserMints(pub);
    await refreshSupply();

    setStatus("Mint successful üî• Check your wallet");

  } catch(e){
    console.error(e);
    setStatus("Mint failed ‚Äì check console");
  }
}

// initial supply fetch
refreshSupply();
</script>
</body>
</html>
