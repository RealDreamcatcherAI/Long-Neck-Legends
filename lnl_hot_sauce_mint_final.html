<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" type="image/png" sizes="32x32" href="https://i.imgur.com/jpGdtHJ.jpeg">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LNL Hot Sauce Mint | Mango Habanero Ascension</title>

  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    body { margin:0; background:#0a0a1a; color:#e0e0ff; font-family:Space Grotesk, Arial; }
    nav { position:fixed; top:0; width:100%; padding:1rem; background:rgba(10,10,26,.9); backdrop-filter:blur(10px); text-align:center; z-index:999; }
    nav a { color:#e0e0ff; margin:0 1rem; text-decoration:none; font-weight:600; }

    section { max-width:1100px; margin:0 auto; padding:2rem; }
    h2 { text-align:center; font-family:Orbitron; font-size:3rem; background:linear-gradient(45deg,#00d4ff,#ff6bff); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }

    .mint-box { background:rgba(10,10,26,.7); border-radius:20px; padding:2rem; box-shadow:0 0 35px rgba(0,212,255,.35); }
    .grid { display:grid; grid-template-columns:1fr 1fr; gap:1.5rem; }

    .card { background:rgba(20,20,40,.6); border-radius:16px; padding:1.5rem; }
    .row { display:flex; justify-content:space-between; margin:.4rem 0; }

    .btn { padding:1rem 2.2rem; border:none; border-radius:40px; font-weight:700; cursor:pointer; background:linear-gradient(45deg,#00d4ff,#0099cc); color:white; box-shadow:0 0 25px rgba(0,212,255,.6); }
    .btn.secondary { background:linear-gradient(45deg,#7b68ee,#5a4fc3); }
    .btn:disabled { opacity:.5 }

    footer { text-align:center; padding:2rem; color:#777 }

    @media(max-width:900px){ .grid{grid-template-columns:1fr;} }
  </style>
</head>

<body>
<nav>
  <a href="https://longnecklegends.xyz">Home</a>
  <a href="#mint">Mint</a>
</nav>

<section style="padding-top:120px;text-align:center">
  <img src="https://i.imgur.com/MpqfjdX.png" style="max-width:280px"><br><br>
  <h2>Mango Habanero Ascension</h2>
  <p>33 Legendary Hot Sauce cNFTs. Mint backed by real heat üî•</p>
</section>

<section id="mint">
  <div class="mint-box">
    <h2>‚≠ê Mint to Claim</h2>

    <div class="grid">
      <div class="card">
        <h3>Wallet</h3>
        <div class="row"><span>Wallet</span><span id="walletLabel">Not connected</span></div>
        <div class="row"><span>Status</span><span id="wlStatus">‚Äî</span></div>

        <div style="margin-top:1rem;text-align:center">
          <button class="btn" id="btnConnect">Connect Wallet</button>
        </div>

        <p id="status" style="margin-top:1rem;text-align:center">Ready.</p>
      </div>

      <div class="card">
        <h3>Collection</h3>
        <div class="row"><span>Total Supply</span><span>33</span></div>
        <div class="row"><span>Minted</span><span id="minted">‚Äî</span></div>
        <div class="row"><span>Remaining</span><span id="remaining">‚Äî</span></div>
        <div class="row"><span>Price</span><span id="priceLabel">‚Äî</span></div>

        <div style="margin-top:1rem;text-align:center">
          <button class="btn secondary" id="btnMint">Mint Hot Sauce NFT</button>
        </div>
      </div>
    </div>
  </div>
</section>

<footer>¬© 2026 Long Neck Legends</footer>

<script type="module">
import { Connection, PublicKey, Transaction, SystemProgram, LAMPORTS_PER_SOL } from "https://esm.sh/@solana/web3.js@1.95.2";
import { createUmi } from "https://esm.sh/@metaplex-foundation/umi-bundle-defaults@0.9.2";
import { mplBubblegum, mintV1 } from "https://esm.sh/@metaplex-foundation/mpl-bubblegum@0.7.0";
import { walletAdapterIdentity } from "https://esm.sh/@metaplex-foundation/umi-signer-wallet-adapters@0.9.2";
import { publicKey as umiPublicKey } from "https://esm.sh/@metaplex-foundation/umi@0.9.2";

// ================= CONFIG ==================
const RPC = "https://api.mainnet-beta.solana.com";
const COLLECTION_MINT = "FppBKa2FvrKt8UTw86spnv7ZMmjpSpXNLhjtdBYKw86i";
const MERKLE_TREE = "DjwAtzNVx1b3w7z9br8C8BJ4hna1uX87ZE7sxxbD4V3i";
const TREASURY = "AoKpHZCEnTC8mBN53dVWsuzVRMAWR1H71bUdHmKxVAem";
const METADATA_BASE = "https://longnecklegends.xyz/MHHSmetadata/";

const TOTAL_SUPPLY = 33;
const WL_PRICE = 0.25;
const PUBLIC_PRICE = 0.30;

// LNL holder whitelist
const LNL_COLLECTION = "2WvxCvgFUiqUSBx32c5Z5Zsbcu4ZJCE1GEaaWpbD685P";
const HELIUS_RPC = "https://rpc.helius.xyz/?api-key=free";

// ================= STATE ==================
const connection = new Connection(RPC, "confirmed");
let wallet = null;
let umi = null;
let mintPrice = PUBLIC_PRICE;

const walletLabel = document.getElementById("walletLabel");
const wlStatus = document.getElementById("wlStatus");
const mintedLabel = document.getElementById("minted");
const remainingLabel = document.getElementById("remaining");
const priceLabel = document.getElementById("priceLabel");
const statusBox = document.getElementById("status");

function setStatus(msg){ statusBox.textContent = msg; }

// ================= WALLET ==================

async function connectWallet(){
  if (!window.phantom?.solana) {
    window.open("https://phantom.app");
    return;
  }

  const resp = await window.phantom.solana.connect();
  wallet = window.phantom.solana;

  umi = createUmi(RPC)
    .use(mplBubblegum())
    .use(walletAdapterIdentity(wallet));

  const pubkey = resp.publicKey.toBase58();
  walletLabel.textContent = pubkey.slice(0,4) + "..." + pubkey.slice(-4);

  await checkWhitelist(pubkey);
  await refreshSupply();

  setStatus("Wallet connected üî•");
}

// ================= WL CHECK ==================
async function checkWhitelist(pubkey){
  try{
    const res = await fetch(HELIUS_RPC, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        jsonrpc: "2.0",
        id: "wl",
        method: "getAssetsByOwner",
        params: { ownerAddress: pubkey, page: 1, limit: 1000 }
      })
    });

    const json = await res.json();
    const assets = json.result.items || [];

    const holdsLNL = assets.some(a =>
      a.grouping?.some(g => g.group_value === LNL_COLLECTION)
    );

    if (holdsLNL) {
      mintPrice = WL_PRICE;
      wlStatus.textContent = "Whitelist (LNL Holder)";
      priceLabel.textContent = WL_PRICE + " SOL";
    } else {
      mintPrice = PUBLIC_PRICE;
      wlStatus.textContent = "Public";
      priceLabel.textContent = PUBLIC_PRICE + " SOL";
    }

  } catch(e){
    console.error(e);
    wlStatus.textContent = "Public";
    mintPrice = PUBLIC_PRICE;
    priceLabel.textContent = PUBLIC_PRICE + " SOL";
  }
}

// ================= SUPPLY ==================

async function refreshSupply(){
  const tree = new PublicKey(MERKLE_TREE);
  const acct = await connection.getAccountInfo(tree);
  const minted = Math.min(acct.data.length % TOTAL_SUPPLY, TOTAL_SUPPLY);

  mintedLabel.textContent = minted;
  remainingLabel.textContent = TOTAL_SUPPLY - minted;
}

// ================= MINT ==================

async function mint(){
  if (!wallet) { setStatus("Connect wallet first"); return; }

  const pubkey = wallet.publicKey.toBase58();

  try{
    setStatus(`Paying ${mintPrice} SOL‚Ä¶`);

    const tx = new Transaction().add(
      SystemProgram.transfer({
        fromPubkey: wallet.publicKey,
        toPubkey: new PublicKey(TREASURY),
        lamports: mintPrice * LAMPORTS_PER_SOL
      })
    );

    tx.feePayer = wallet.publicKey;
    tx.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;

    const signed = await wallet.signTransaction(tx);
    const sig = await connection.sendRawTransaction(signed.serialize());
    await connection.confirmTransaction(sig);

    const index = Number(mintedLabel.textContent);
    const uri = METADATA_BASE + index + ".json";

    setStatus("Minting cNFT‚Ä¶ üî•");

    await mintV1(umi, {
      leafOwner: umiPublicKey(pubkey),
      merkleTree: umiPublicKey(MERKLE_TREE),
      metadata: {
        name: `Mango Habanero Ascension #${index}`,
        uri,
        sellerFeeBasisPoints: 1000,
        collection: { key: umiPublicKey(COLLECTION_MINT), verified: false },
        creators: [{ address: umiPublicKey(TREASURY), verified: true, share: 100 }]
      }
    }).sendAndConfirm(umi);

    setStatus("Mint successful üî• Check your wallet");
    await refreshSupply();

  } catch(e){
    console.error(e);
    setStatus("Mint failed ‚Äì check console");
  }
}

// ================= EVENTS ==================

document.getElementById("btnConnect").onclick = connectWallet;
document.getElementById("btnMint").onclick = mint;

refreshSupply();
priceLabel.textContent = PUBLIC_PRICE + " SOL";

</script>
</body>
</html>
